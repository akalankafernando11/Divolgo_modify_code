#ifndef LED_DRIVER_H
#define LED_DRIVER_H

#define LED_CONTROLLER_ADDRESS 0x45  // AW2013DNR

#define LEDC_RSTR       0x00
#define LEDC_GCR        0x01 
#define LEDC_ISR        0x02
#define LEDC_LCTR       0x30
#define LEDC_LCFG_WHITE    0x33  
#define LEDC_LCFG_RED      0x32
#define LEDC_LCFG_BLUE     0x31
#define LEDC_PWM_WHITE       0x36
#define LEDC_PWM_RED       0x35
#define LEDC_PWM_BLUE       0x34
#define LED_WHITE_T0     0x3D
#define LED_WHITE_T1     0x3E
#define LED_WHITE_T2     0x3F
#define LED_RED_T0     0x3A
#define LED_RED_T1     0x3B     
#define LED_RED_T2     0x3C
#define LED_BLUE_T0     0x37
#define LED_BLUE_T1     0x38
#define LED_BLUE_T2     0x39
#define LEDC_IADR       0X77

/*
LED0 : GREEN
LED1 : RED
LED2 : BLUE
*/
void led_reset_all(){
    write_i2c(LED_CONTROLLER_ADDRESS,    LEDC_RSTR,      0x55);   
}

void led_blinking_charging() {
    write_i2c(LED_CONTROLLER_ADDRESS,    LEDC_RSTR,      0x55);   
    write_i2c(LED_CONTROLLER_ADDRESS,    LEDC_GCR,      0x01);

    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000000);
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_RED, 20);
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_RED, 0b00000001);  // FO|FI|MD|IMAX
    write_i2c(LED_CONTROLLER_ADDRESS, LED_RED_T0, 0b00000001); // T1|T2
    write_i2c(LED_CONTROLLER_ADDRESS, LED_RED_T1, 0b00000001); // T3|T4
    write_i2c(LED_CONTROLLER_ADDRESS, LED_RED_T2, 0b00000000); // T0|REPEAT

    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_RED, 0b00010001);  // FO|FI|MD|IMAX
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000010);
}

void led_blinking_full_charge() {
    write_i2c(LED_CONTROLLER_ADDRESS,    LEDC_RSTR,      0x55);    // Reset all
    write_i2c(LED_CONTROLLER_ADDRESS,    LEDC_GCR,      0x01);      // LED function enable

    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000000);
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_WHITE, 50);
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_WHITE, 0b00000001);  // FO|FI|MD|IMAX
    write_i2c(LED_CONTROLLER_ADDRESS, LED_WHITE_T0, 0b00000001); // T1|T2
    write_i2c(LED_CONTROLLER_ADDRESS, LED_WHITE_T1, 0b00000001); // T3|T4
    write_i2c(LED_CONTROLLER_ADDRESS, LED_WHITE_T2, 0b00000000); // T0|REPEAT

    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_WHITE, 0b00010001);  // FO|FI|MD|IMAX
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000100);
}

void led_blinking_low_battery_power_off() {    
    write_i2c(LED_CONTROLLER_ADDRESS,    LEDC_RSTR,      0x55);   
    write_i2c(LED_CONTROLLER_ADDRESS,    LEDC_GCR,      0x01);

    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000000);
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_RED, 50);
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_RED, 0b00000001);  // FO|FI|MD|IMAX
    write_i2c(LED_CONTROLLER_ADDRESS, LED_RED_T0, 0b00000000); // T1|T2
    write_i2c(LED_CONTROLLER_ADDRESS, LED_RED_T1, 0b00000000); // T3|T4
    write_i2c(LED_CONTROLLER_ADDRESS, LED_RED_T2, 0b00000000); // T0|REPEAT

    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_RED, 0b00010001);  // FO|FI|MD|IMAX
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000010);
}

void led_blinking_power_off() {    
    // write_i2c(LED_CONTROLLER_ADDRESS, LEDC_RSTR, 0x55);         // Reset all
    write_i2c(LED_CONTROLLER_ADDRESS,    LEDC_GCR,      0x01); 
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000111);   // Enable all LEDs
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_WHITE, 0xf0);   // Enable all LEDs
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_RED, 0xf0);   // Enable all LEDs
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_BLUE, 0xf0);   // Enable all LEDs
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_WHITE, 0b00010001);  // FO|FI|MD|IMAX
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_RED, 0b00010001);  // FO|FI|MD|IMAX
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_BLUE, 0b00010001);  // FO|FI|MD|IMAX
}

void led_blinking_battery_level(int percentage) {   
    // uint8_t pwm_val = map(percentage, 0, 100, 0, 255);
    // write_i2c(LED_CONTROLLER_ADDRESS, LEDC_RSTR, 0x55);         // Reset all
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_GCR,      0x01); 
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000001);   // Enable all LEDs
    // write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_WHITE, 0xf0);   // Enable all LEDs
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_RED, 0b00000001);  // FO|FI|MD|IMAX
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_WHITE, 0b00000001);  // FO|FI|MD|IMAX

    // write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_RED, (100-percentage));   // Enable all LEDs
    // write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_BLUE, percentage);   // Enable all LEDs
    if (percentage > 60) 
    {
        write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_RED, 0);   // Enable all LEDs
        write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_WHITE, 20);   // Enable all LEDs
    } 
    else if ( percentage > 30)
    {
        write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_RED, 20);   // Enable all LEDs
        write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_WHITE, 20);   // Enable all LEDs
    } 
    else
    {
        write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_RED, 20);   // Enable all LEDs
        write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_WHITE, 0);   // Enable all LEDs
    }

    
    // write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_WHITE, 0b00010001);  // FO|FI|MD|IMAX
   
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000111);   // Enable all LEDs
}

void led_blinking_wifi_success() {
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000110);
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_BLUE, 30);
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_BLUE, 0b00000001);  // FO|FI|MD|IMAX
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000111);
}

void led_blinking_conection_sleep() {
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000110);
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_BLUE, 30);
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_BLUE, 0b00000001);  // FO|FI|MD|IMAX
    write_i2c(LED_CONTROLLER_ADDRESS, LED_BLUE_T0, 0b01110000); // T1|T2
    write_i2c(LED_CONTROLLER_ADDRESS, LED_BLUE_T1, 0b01110100); // T3|T4
    write_i2c(LED_CONTROLLER_ADDRESS, LED_BLUE_T2, 0b00000000); // T0|REPEAT

    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_BLUE, 0b01110001);  // FO|FI|MD|IMAX
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000111);
}

void led_blinking_wifi_fail() {
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000110);
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_BLUE, 0);
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_BLUE, 0b00000001);  // FO|FI|MD|IMAX
    write_i2c(LED_CONTROLLER_ADDRESS, LED_BLUE_T0, 0b00000000); // T1|T2
    write_i2c(LED_CONTROLLER_ADDRESS, LED_BLUE_T1, 0b00000000); // T3|T4
    write_i2c(LED_CONTROLLER_ADDRESS, LED_BLUE_T2, 0b00000000); // T0|REPEAT

    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_BLUE, 0b00000001);  // FO|FI|MD|IMAX
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000111);
}

void led_blinking_trying_to_connect() {
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000110);
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_BLUE, 30);
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_BLUE, 0b00000001);  // FO|FI|MD|IMAX
    write_i2c(LED_CONTROLLER_ADDRESS, LED_BLUE_T0, 0b00000000); // T1|T2
    write_i2c(LED_CONTROLLER_ADDRESS, LED_BLUE_T1, 0b00000000); // T3|T4
    write_i2c(LED_CONTROLLER_ADDRESS, LED_BLUE_T2, 0b00000000); // T0|REPEAT

    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_BLUE, 0b01110001);  // FO|FI|MD|IMAX
    write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000111);
}

// void led_blinking_ota_check() {
//     write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000110);
//     write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_BLUE, 50);
//     write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_BLUE, 0b00000001);  // FO|FI|MD|IMAX
//     write_i2c(LED_CONTROLLER_ADDRESS, LED_BLUE_T0, 0b00000100); // T1|T2
//     write_i2c(LED_CONTROLLER_ADDRESS, LED_BLUE_T1, 0b00000000); // T3|T4
//     write_i2c(LED_CONTROLLER_ADDRESS, LED_BLUE_T2, 0b00000000); // T0|REPEAT

//     write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_BLUE, 0b01110001);  // FO|FI|MD|IMAX
//     write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000111);
// }

// void led_blinking_ota_update_receive() {
//     write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000110);
//     write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_WHITE, 0x0F);
//     write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_WHITE, 0b00000001);  // FO|FI|MD|IMAX
//     write_i2c(LED_CONTROLLER_ADDRESS, LED_WHITE_T0, 0b00000100); // T1|T2
//     write_i2c(LED_CONTROLLER_ADDRESS, LED_WHITE_T1, 0b00000010); // T3|T4
//     write_i2c(LED_CONTROLLER_ADDRESS, LED_WHITE_T2, 0b00000000); // T0|REPEAT

//     write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_WHITE, 0b01110001);  // FO|FI|MD|IMAX
//     write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000111);
// }

// void led_blinking_ota_update_success() {
//     write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000110);
//     write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_BLUE, 0xF0);
//     write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_BLUE, 0b00000001);  // FO|FI|MD|IMAX
//     write_i2c(LED_CONTROLLER_ADDRESS, LED_BLUE_T0, 0b00000010); // T1|T2
//     write_i2c(LED_CONTROLLER_ADDRESS, LED_BLUE_T1, 0b00000010); // T3|T4
//     write_i2c(LED_CONTROLLER_ADDRESS, LED_BLUE_T2, 0b00000100); // T0|REPEAT

//     write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_BLUE, 0b01110001);  // FO|FI|MD|IMAX
//     write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000111);
// }

// void led_blinking_ota_update_fail() {
//     write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000110);
//     write_i2c(LED_CONTROLLER_ADDRESS, LEDC_PWM_BLUE, 0xF0);
//     write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_BLUE, 0b00000001);  // FO|FI|MD|IMAX
//     write_i2c(LED_CONTROLLER_ADDRESS, LED_BLUE_T0, 0b00000001); // T1|T2
//     write_i2c(LED_CONTROLLER_ADDRESS, LED_BLUE_T1, 0b00000001); // T3|T4
//     write_i2c(LED_CONTROLLER_ADDRESS, LED_BLUE_T2, 0b00001111); // T0|REPEAT

//     write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCFG_BLUE, 0b01110001);  // FO|FI|MD|IMAX
//     write_i2c(LED_CONTROLLER_ADDRESS, LEDC_LCTR, 0b00000111);
// }


#endif /* LED_DRIVER_H */
